<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buena Vida - Vitrina</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/estilos/global.css"/>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light px-3">
    <a class="navbar-brand" href="#">
      <img src="assets/logo.jpg" alt="Buena Vida" style="height: 50px;">
    </a>
    <div class="ms-auto d-flex align-items-center gap-3">
      <a href="favoritos.html" class="btn btn-outline-danger" title="Favoritos">‚ù§Ô∏è</a>
      <a href="cuenta.html" class="btn btn-outline-secondary" title="Mi Cuenta">üë§</a>
      <button id="btn-carrito" class="btn btn-outline-success position-relative" title="Mi carrito">
        üõí
        <span id="contador-carrito" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
      </button>
    </div>
  </nav>

  <main class="container-fluid my-4">
    <div class="row">
      <aside class="col-md-3 mb-4 px-4">
        <h5 class="mb-3">üîç Filtros</h5>
        <div class="mb-3">
          <input type="text" id="buscador" class="form-control" placeholder="Buscar productos..."/>
        </div>
        <div class="mb-3">
          <label for="precio-min" class="form-label">Precio m√≠nimo</label>
          <input type="number" id="precio-min" class="form-control" placeholder="0"/>
        </div>
        <div class="mb-3">
          <label for="precio-max" class="form-label">Precio m√°ximo</label>
          <input type="number" id="precio-max" class="form-control" placeholder="1000"/>
        </div>
        <button class="btn btn-success w-100" id="btn-buscar">Aplicar filtros</button>
      </aside>

      <section class="col-md-9">
        <div id="contenedor-productos" class="row g-4"></div>
        <nav class="mt-4" id="paginacion"></nav>
      </section>
    </div>
  </main>

  <!-- IU-10: Resumen flotante de carrito -->
  <div id="resumen-carrito" class="position-fixed bottom-0 end-0 bg-white border p-3 shadow d-none" style="max-width: 320px; z-index: 1050;">
    <h5>üõí Tu carrito</h5>
    <div id="carrito-items" class="mb-2">
      <p class="text-muted small">Tu carrito est√° vac√≠o.</p>
    </div>
    <hr>
    <button onclick="window.location.href='carrito.html'" class="btn btn-primary w-100 mb-2">Ir al carrito</button>
    <button class="btn btn-success w-100">Realizar pedido</button>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="build/favoritos/modelo.js"></script>
  <script type="module" src="build/carrito/modelo.js"></script>
  <script type="module" src="build/modal/controlador.js"></script>
  <script type="module" src="build/vitrina/controlador.js"></script>

  <!-- IU-10: Script resumen flotante con cantidades -->
  <script>
    const resumenCarrito = document.getElementById("resumen-carrito");
    const btnCarrito = document.getElementById("btn-carrito");
    const carritoItems = document.getElementById("carrito-items");
    const contador = document.getElementById("contador-carrito");

    function actualizarResumenCarrito() {
      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];

      contador.textContent = carrito.length;

      if (carrito.length === 0) {
        carritoItems.innerHTML = `<p class="text-muted small">Tu carrito est√° vac√≠o.</p>`;
        return;
      }

      carritoItems.innerHTML = "";
      carrito.forEach(producto => {
        const cantidad = producto.cantidad ?? 1;
        const total = (producto.precio * cantidad).toFixed(2);

        const div = document.createElement("div");
        div.className = "d-flex justify-content-between align-items-center mb-2";
        div.innerHTML = `
          <div class="flex-grow-1 pe-2">
            <div class="fw-semibold text-truncate" title="${producto.nombre}">${producto.nombre}</div>
            <small class="text-muted">Cantidad: ${cantidad}</small>
          </div>
          <span class="fw-bold">$${total}</span>
        `;
        carritoItems.appendChild(div);
      });
    }

    btnCarrito.addEventListener("click", () => {
      resumenCarrito.classList.toggle("d-none");
      actualizarResumenCarrito();
    });

    actualizarResumenCarrito();
  </script>
</body>
</html>
